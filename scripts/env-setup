#!/bin/bash

cd

if [ -z "$(dpkg --get-selections | grep -v deinstall | grep libssl-dev)" ]; then
	sudo apt update
	sudo apt-get -y install build-essential libssl-dev
fi

cd ~/Programs


if [ ! -d misc-scripts ]; then
	git clone https://github.com/VectorCell/misc-scripts
fi
cd misc-scripts
git pull
yes | ./install.sh
cd ..

# check if there's a new version of this script
SUM_THIS=$(md5sum ${BASH_SOURCE[0]} | awk '{print $1}')
SUM_THAT=$(md5sum ~/Programs/misc-scripts/scripts/env-setup | awk '{print $1}')
if [ "$SUM_THIS" != "$SUM_THAT" ]; then
	cp ~/Programs/misc-scripts/scripts/env-setup /tmp/env-setup-2
	/tmp/env-setup-2
	rm /tmp/env-setup-2
	exit
fi

if [ ! -d dotfiles ]; then
	git clone https://github.com/VectorCell/dotfiles
fi
cd dotfiles
git pull
yes | ./install.sh
cd ..

if [ ! -d pubkeys ]; then
	git clone https://github.com/VectorCell/pubkeys
fi
cd pubkeys
git pull
./add-keys.sh
cd ..

if [ ! -d tmux-configuration ]; then
	git clone https://github.com/VectorCell/tmux-configuration
fi
cd tmux-configuration
git pull
yes | ./install.sh
cd ..

if [ ! -d install-scripts ]; then
	git clone https://github.com/VectorCell/install-scripts
fi
cd install-scripts
git pull
cd ..

if [ ! -d sublime-config ]; then
	git clone https://github.com/VectorCell/sublime-config
fi
cd sublime-config
git pull
./install.sh
cd ..

if [ ! -d output-sparse ]; then
	git clone https://github.com/VectorCell/output-sparse
fi
cd output-sparse
git pull
make
make install
cd ..

# git clone https://github.com/VectorCell/music-control
# cd music-control
# git pull
# ./install.sh
# cd ..

# git clone https://github.com/VectorCell/openssl-encrypt
# cd openssl-encrypt
# git pull
# ./install.sh
# cd ..

if [ ! -d sumpass ]; then
	git clone https://github.com/VectorCell/sumpass
fi
cd sumpass
git pull
make
make install
cd ..

if [ ! -d xxHash ]; then
	git clone https://github.com/Cyan4973/xxHash
fi
cd xxHash
git pull
make
ln -s ~/Programs/xxHash/xxhsum ~/bin/xxhsum
cd ..

if [ -f ~/bin/youtube-dl ]; then
	rm -f ~/bin/youtube-dl
fi
if [ -f youtube-dl ]; then
	mv youtube-dl youtube-dl-old
fi
wget https://yt-dl.org/downloads/latest/youtube-dl
chmod +x youtube-dl
#ln -s ~/Programs/youtube-dl ~/bin/youtube-dl
echo -e "#!/bin/bash\npython3 \$HOME/Programs/youtube-dl \"\$@\"" > ~/bin/youtube-dl
chmod +x ~/bin/youtube-dl

find ~/bin/ -xtype l | xargs unlink

which output-sparse || echo "unable to find output-sparse"
#which sp || echo "unable to find sp"
which aes-encrypt || echo "unable to find aes-encrypt"
which aes-decrypt || echo "unable to find aes-decrypt"
which sump || echo "unable to find sump"
which xxhsum || echo "unable to find xxhsum"

echo done!
